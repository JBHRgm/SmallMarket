<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>SmallMarket - Register</title>

</head>

<body>
    <h2>Register</h2>
    <form action="/register" id="register-form" name="register-form" method="POST" enctype="application/x-www-form-urlencoded">
        <input type="text" id="username" name="username" maxlength="25" minlength="5" pattern="\S*" placeholder="Benutzername" required>
        <input type="text" id="plz" name="plz" pattern="[0-9]{5}" placeholder="PLZ" required>
        <select id="city" name="city" style="width: 160px;" required ></select>
        <input type="email" id="mail" name="mail" placeholder="Email" required>
        <input type="tel" id="phone" name="phone" placeholder="Telefonnummer">
        <input type="password" id="password" name="password" pattern="[a-zA-Z0-9+-/_]{6,15}" placeholder="Passwort" required>
        <input type="password" id="confirmpwd" name="confirmpwd" placeholder="Passwort wiederholen" required>
        <button type="submit" id="register-submit">Register</button>
    </form>
    <br>
    <div>
        <% for (x in flashes) { %>
            <span><%=x%>: <%=flashes[x]%></span><br>
        <% } %>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script>
        $('#plz').on('keyup', (ev) => {
            let val = $(ev.target).val();
            if (val.length == 5) {
                $.ajax({
                    url: '/register/plz',
                    type: 'GET',
                    data: { plz: val },
                    dataType: 'JSON',
                    success: function (res) {
                        $('#city').children().remove();
                        for(x in res) {
                            let el = document.createElement('option');
                            el.text = res[x];
                            document.getElementById('city').appendChild(el);
                        }
                    }
                })
            }
        })
    </script>
</body>

</html>